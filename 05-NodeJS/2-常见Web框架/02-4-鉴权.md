# 02-4-鉴权

## 一 cookie

```js
app.use(async (ctx) => {
  if (ctx.url === '/index') {
    ctx.cookies.set('MyCookie', 'Test', {
      //domain:'localhost', // 写cookie所在的域名
      // path:'/index',      // 只在该路径下需要cookie
      maxAge: 1000 * 60 * 60 * 24, // 有效时长
      //expires:new Date('2018-12-31'), // 失效时间
      //httpOnly:false,  // 是否只用于http请求中获取
      //overwrite:false  // 是否允许重写
    })
    ctx.body = 'cookie is ok'
  } else {
    if (ctx.cookies.get('MyCookie')) {
      ctx.body = ctx.cookies.get('MyCookie')
    } else {
      ctx.body = 'Cookie is none'
    }
  }
})
```

//注意：koa 不支持直接设置 cookie 值为中文，中文一般使用 Buffer 转换。

```JavaScript
(new Buffer('李四')).toString('base64');    //汉字转换为base64
(new Buffer('dwadwadwa','base64')).toString();  //base64转换为汉字
```

## 二 session 中间件 koa-session

```js
const Koa = require('koa')
const router = require('koa-router')()
const session = require('koa-session')
let app = new Koa()

//配置session的中间件
app.keys = ['some secret hurr'] /*cookie的签名*/
const CONFIG = {
  key: 'koa:sess' /**默认 */,
  maxAge: 86400000 /*cookie的过期时间*/,
  overwrite: true /** (boolean) can overwrite or not (default true)没有效果，默认 */,
  httpOnly: true /**  true表示只有服务器端可以获取cookie */,
  signed: true /** 默认 签名 */,
  rolling: true /** 在每次请求时强行设置 cookie，这将重置 cookie 过期时间（默认：false）*/,
  renew: false /** (boolean) renew session when session is nearly expired */,
}
app.use(session(CONFIG, app))

router.get('/', async (ctx) => {
  if (ctx.session.info) {
    ctx.body = ctx.session.info + '登录成功'
  } else {
    ctx.body = '还没设置session'
  }
})

router.get('/set', async (ctx) => {
  ctx.session.info = 'lisi'
  ctx.body = 'session已设置'
})

app.use(router.routes())
app.listen(3000)
```

## 三 jwt

==TODO===
